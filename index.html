<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learner Alom</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Monetag SDK Code -->
    <script src='//libtl.com/sdk.js' data-zone='9877815' data-sdk='show_9877815'></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #9953ff 0%, #34026c 100%); color: #fff; min-height: 100vh; padding: 20px; display: flex; justify-content: center; align-items: center; }
        .container { max-width: 900px; width: 100%; }
        header { display: flex; align-items: center; padding: 10px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 10px; margin-bottom: 20px; }
        .profile-pic { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 1px solid #fff; margin-right: 15px; }
        .profile-info h1 { color: #fff; font-size: 24px; margin-bottom: 10px; border-bottom: 2px solid rgba(255, 255, 255, 0.4); }
        .profile-info p { color: #ddd; font-size: 16px; }
        /* --- Banner Ad Styling --- */

/* The main container for the banner ad */
.banner-ad {
    margin-top: 20px; /* উপরের অংশ থেকে একটু দূরত্ব তৈরি করবে */
    margin-bottom: 20px; /* নিচের অংশ থেকে একটু দূরত্ব তৈরি করবে */
    padding: 10px; /* ভেতরের দিকে কিছুটা জায়গা রাখবে */
    display: flex; /* কন্টেন্টকে সেন্টারে আনার জন্য */
    justify-content: center; /* কন্টেন্টকে অনুভূমিকভাবে (horizontally) সেন্টারে রাখবে */
    align-items: center; /* কন্টেন্টকে উল্লম্বভাবে (vertically) সেন্টারে রাখবে */
    min-height: 50px; /* বিজ্ঞাপনের একটি ন্যূনতম উচ্চতা নির্ধারণ করবে */
    background: rgba(0, 0, 0, 0.15); /* একটি হালকা কালো ব্যাকগ্রাউন্ড দেবে */
    border-radius: 10px; /* কোণগুলোকে গোলাকার করবে */
    border: 1px solid rgba(255, 255, 255, 0.2); /* একটি হালকা সাদা বর্ডার দেবে */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* একটি হালকা শ্যাডো যুক্ত করবে */
    overflow: hidden; /* যদি বিজ্ঞাপন কন্টেইনারের বাইরে চলে যায়, তবে লুকিয়ে রাখবে */
}

/* This targets any direct children inside the banner container, like iframes or images */
.banner-ad > * {
    max-width: 100%; /* বিজ্ঞাপন যেন কন্টেইনারের বাইরে না যায় */
    display: block; /* ডিসপ্লে ব্লক করে অতিরিক্ত ফাঁকা জায়গা দূর করবে */
}

/* Specifically for iframes, which some ad networks use */
.banner-ad iframe {
    border: none; /* iframe এর ডিফল্ট বর্ডার মুছে ফেলবে */
    vertical-align: middle; /* মাঝখানে অ্যালাইন করতে সাহায্য করে */
}

/* For smaller screens (Mobile Responsive) */
@media (max-width: 768px) {
    .banner-ad {
        padding: 5px; /* মোবাইল ডিভাইসের জন্য প্যাডিং কিছুটা কমাবে */
    }
}
        .slider-container { position: relative; width: 100%; height: 250px; overflow: hidden; border-radius: 10px; margin-bottom: 20px; background: rgba(0,0,0,0.2); }
        .slider { display: flex; transition: transform 0.5s ease-in-out; width: 100%; height: 100%; }
        .slide { min-width: 100%; height: 100%; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        .slider-controls { position: absolute; bottom: 15px; left: 0; right: 0; display: flex; justify-content: center; gap: 10px; }
        .slider-dot { width: 12px; height: 12px; border-radius: 50%; background: rgba(255, 255, 255, 0.5); cursor: pointer; transition: background 0.3s; }
        .slider-dot.active { background: white; }
        .main-content { padding: 20px 0; }
        .section-title { font-size: 24px; color: #fff; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid rgba(255, 255, 255, 0.4); }
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .file-card { background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.4); }
        .file-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
        .file-image { width: 100%; height: 160px; object-fit: cover; }
        .file-details { padding: 15px; }
        .file-title { font-size: 18px; color: #fff; margin-bottom: 8px; }
        .file-description { color: #ddd; font-size: 14px; margin-bottom: 15px; line-height: 1.4; }
        .unlock-btn { display: block; width: 100%; padding: 12px; background: linear-gradient(to right, #6a11cb, #2575fc); color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .unlock-btn:hover:not(:disabled) { background: linear-gradient(to right, #2575fc, #6a11cb); }
        .unlock-btn:disabled { background: #555; color: #999; cursor: not-allowed; }
        .unlock-btn.download-ready { background: linear-gradient(to right, #28a745, #218838); }
        .unlock-btn i { margin-right: 8px; }
        footer { text-align: center; padding: 20px; margin-top: 20px; background: rgba(0, 0, 0, 0.2); color: white; font-size: 14px; border-radius: 10px; }
        @media (max-width: 768px) { .file-grid { grid-template-columns: 1fr; } header { flex-direction: column; text-align: center; } .profile-pic { margin-right: 0; margin-bottom: 10px; } .slider-container { height: 200px; } }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #34026c; display: flex; justify-content: center; align-items: center; z-index: 1000; color: white; font-size: 2em; }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">Loading...</div>
    <div class="container" id="appContainer" style="display:none;">
        <header>
            <img src="" alt="Profile Picture" class="profile-pic" id="profilePic">
            <div class="profile-info"> <h1 id="profileName"></h1> <p id="profileDesc"></p> </div>
        </header>
        <div class="banner-ad" id="bannerAdContainer"></div>
        <div class="slider-container">
            <div class="slider" id="slider"></div>
            <div class="slider-controls" id="sliderControls"></div>
        </div>
        <div class="main-content">
            <h2 class="section-title">Available Files</h2>
            <div class="file-grid" id="fileGrid"></div>
        </div>
        <footer id="footerContainer"><p id="footerText"></p></footer>
    </div>

    <!-- Firebase v9 (modular) script -->
    <script type="module">
        // Firebase v9 Modular Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
        
        // --- START: আপনার FIREBASE CONFIG এখানে পেস্ট করুন ---
        const firebaseConfig = {
          apiKey: "AIzaSyCQvwxezeFwUW-8iuGqKn6Vzx8fqA-lq8w",
          authDomain: "learner-alom.firebaseapp.com",
          databaseURL: "https://learner-alom-default-rtdb.firebaseio.com",
          projectId: "learner-alom",
          storageBucket: "learner-alom.appspot.com",
          messagingSenderId: "812834864427",
          appId: "1:812834864427:web:c1d1a2fc89c59c30cb596e"
        };
        // --- END: আপনার FIREBASE CONFIG এখানে পেস্ট করুন ---
        
        // Firebase Initialization
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Global settings
        let maxClicks = 10;
        let countdownTime = 30;

        window.addEventListener('DOMContentLoaded', () => {
            const dataRef = ref(db, 'appData');
            get(dataRef).then((snapshot) => {
                if (snapshot.exists()) {
                    populatePage(snapshot.val());
                } else {
                    document.getElementById('loadingOverlay').innerText = 'Configuration not found.';
                }
            }).catch((error) => {
                console.error(error);
                document.getElementById('loadingOverlay').innerText = 'Error loading data.';
            });
        });

        function populatePage(data) {
            document.getElementById('profilePic').src = data.profile.imageUrl;
            document.getElementById('profileName').textContent = data.profile.name;
            document.getElementById('profileDesc').textContent = data.profile.description;
            
            // --- পরিবর্তিত অংশ ---
            if (data.ads && data.ads.bannerCode) {
                loadAdScript(document.getElementById('bannerAdContainer'), data.ads.bannerCode);
            }
            
            const slider = document.getElementById('slider');
            const sliderControls = document.getElementById('sliderControls');
            slider.innerHTML = '';
            sliderControls.innerHTML = '';
            // --- এখানে ডেটা স্ট্রাকচার ঠিক করা হয়েছে ---
            const sliderImages = data.slider ? [data.slider.slide1, data.slider.slide2, data.slider.slide3].filter(Boolean) : [];
            sliderImages.forEach((imgUrl, index) => {
                slider.innerHTML += `<div class="slide"><img src="${imgUrl}" alt="Slide ${index+1}"></div>`;
                sliderControls.innerHTML += `<div class="slider-dot ${index === 0 ? 'active' : ''}"></div>`;
            });
            initializeSlider();

            maxClicks = data.settings?.requiredClicks || 10;
            countdownTime = data.settings?.countdownTime || 30;

            const fileGrid = document.getElementById('fileGrid');
            fileGrid.innerHTML = '';
            // --- এখানে ডেটা স্ট্রাকচার ঠিক করা হয়েছে ---
            if (data.fileCards && Array.isArray(data.fileCards)) {
                data.fileCards.forEach(card => {
                    const cardHTML = `
                        <div class="file-card">
                            <img src="${card.imageUrl}" alt="${card.title}" class="file-image">
                            <div class="file-details">
                                <h3 class="file-title">${card.title}</h3>
                                <p class="file-description">${card.description}</p>
                                <button class="unlock-btn" data-clicks="0" data-link="${card.downloadLink}">
                                    <i class="fas fa-lock"></i> Unlock (0/${maxClicks})
                                </button>
                            </div>
                        </div>`;
                    fileGrid.innerHTML += cardHTML;
                });
            }

            document.getElementById('footerText').innerHTML = data.footer.text;
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
        }
        
        function initializeSlider() {
            const slider = document.querySelector('.slider');
            if (!slider) return;
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.slider-dot');
            if (slides.length === 0) return;

            let currentSlide = 0;
            const slideCount = slides.length;
            const updateSlider = () => { 
                slider.style.transform = `translateX(-${currentSlide * 100}%)`; 
                dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlide)); 
            };
            const nextSlide = () => { currentSlide = (currentSlide + 1) % slideCount; updateSlider(); };
            dots.forEach((dot, i) => dot.addEventListener('click', () => { currentSlide = i; updateSlider(); }));
            setInterval(nextSlide, 5000);
        }
        
        document.getElementById('fileGrid').addEventListener('click', function(event) {
            const button = event.target.closest('.unlock-btn');
            if (button) {
                handleUnlockClick(button);
            }
        });

        function handleUnlockClick(button) {
            let currentClicks = parseInt(button.dataset.clicks);
            const downloadLink = button.dataset.link;
            if (button.disabled) return;
            if (currentClicks >= maxClicks) {
                if(downloadLink) window.open(downloadLink, '_blank');
                return;
            }
            try {
                if (typeof window['show_9877815'] === 'function') { window['show_9877815'](); }
            } catch (e) { console.error("Error showing ad:", e); }

            currentClicks++;
            button.dataset.clicks = currentClicks;

            if (currentClicks >= maxClicks) {
                button.innerHTML = 'Download 📥';
                button.classList.add('download-ready');
            } else {
                button.disabled = true;
                let timeLeft = countdownTime;
                button.innerHTML = `অপেক্ষা করুন... (${timeLeft}s)`;
                const countdownInterval = setInterval(() => {
                    timeLeft--;
                    button.innerHTML = `অপেক্ষা করুন... (${timeLeft}s)`;
                    if (timeLeft <= 0) {
                        clearInterval(countdownInterval);
                        button.disabled = false;
                        button.innerHTML = `<i class="fas fa-lock"></i> Unlock (${currentClicks}/${maxClicks})`;
                    }
                }, 1000);
            }
        }

        // --- নতুন ফাংশনটি এখানে যোগ করা হয়েছে ---
        function loadAdScript(container, htmlString) {
            if (!container || !htmlString) return;
            container.innerHTML = ''; // Clear previous content
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlString;

            const scripts = Array.from(tempDiv.querySelectorAll('script'));
            
            scripts.forEach(oldScript => {
                const newScript = document.createElement('script');
                Array.from(oldScript.attributes).forEach(attr => {
                    newScript.setAttribute(attr.name, attr.value);
                });
                if (oldScript.innerHTML) {
                    newScript.text = oldScript.innerHTML;
                }
                container.appendChild(newScript);
                oldScript.parentNode.removeChild(oldScript);
            });

            while (tempDiv.firstChild) {
                container.appendChild(tempDiv.firstChild);
            }
        }
    </script>
</body>
</html>
